import uuid
from sammy.repositories.users_repository import UsersRepository
from sammy.managers.password_manager import PasswordManager

users_repository = UsersRepository()

class UsersService:

    def create_user(self, username, password):
        if len(users_repository.query_by_secondary_index(username)) > 0:
            raise ValueError("User already exists")

        uid = uuid.uuid4()
        hashed_password = PasswordManager.hash_password(password)

        item = {
            'id': uid.hex,
            'username': username,
            'password': hashed_password,
            'is_admin': False
        }

        users_repository.put_item(item)

        return item

    def get_user_by_id(self, uid):
        return users_repository.get_item(uid)
